@model CreateReviewViewModel
@using Lumera.Models.ViewModels
@{
    ViewData["Title"] = "Leave a Review - LUMERA";
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>@ViewData["Title"]</title>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#13a4ec",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101c22",
                    },
                    fontFamily: { "display": ["Manrope"] },
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }

        .star-rating {
            display: flex;
            gap: 0.5rem;
            font-size: 2.5rem;
        }

        .star {
            cursor: pointer;
            transition: all 0.2s ease;
            color: #d1d5db;
        }

            .star:hover,
            .star.active {
                color: #fbbf24;
            }

            .star:hover {
                transform: scale(1.1);
            }
    </style>
</head>
<body class="font-display bg-background-light text-stone-800">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside class="w-64 bg-white flex flex-col border-r border-stone-200 fixed left-0 top-0 h-screen z-30">
            <div class="p-6 flex items-center gap-3">
                <div class="bg-primary p-2 rounded-lg">
                    <span class="material-symbols-outlined text-white">event</span>
                </div>
                <h1 class="text-xl font-bold text-stone-900">LUMERA</h1>
            </div>
            <div class="px-6 py-4 border-b border-stone-200">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center">
                        <span class="material-symbols-outlined text-primary">person</span>
                    </div>
                    <div>
                        <p class="font-semibold text-stone-900">Don Quixote</p>
                        <p class="text-sm text-stone-500">Client</p>
                    </div>
                </div>
            </div>
            <nav class="flex-1 px-4 py-2">
                <a class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-primary/10 text-stone-600" href="/client/dashboard"><span class="material-symbols-outlined">dashboard</span> Dashboard</a>
                <a class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-primary/10 text-stone-600" href="/client/events"><span class="material-symbols-outlined">event</span> My Events</a>
                <a class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-primary/10 text-stone-600" href="/client/browse"><span class="material-symbols-outlined">search</span> Browse & Book</a>
                <a class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-primary/10 text-stone-600" href="/client/bookings"><span class="material-symbols-outlined">book_online</span> Bookings & Services</a>
                <a class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-primary/10 text-stone-600" href="/client/messages"><span class="material-symbols-outlined">mail</span> Messages</a>
                <a class="flex items-center gap-3 px-4 py-2 rounded-lg bg-primary/10 text-primary font-bold" href="/client/reviews"><span class="material-symbols-outlined">reviews</span> My Reviews</a>
                <a class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-primary/10 text-stone-600" href="/client/profile"><span class="material-symbols-outlined">settings</span> Profile Settings</a>
            </nav>
            <div class="p-4 border-t border-stone-200 mt-auto">
                <a class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-primary/10 text-stone-600" href="/home/index"><span class="material-symbols-outlined">logout</span> Logout</a>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col ml-64">
            <header class="flex h-16 items-center justify-between border-b border-stone-200 bg-white px-6 fixed top-0 right-0 left-64 z-20">
                <div class="flex items-center gap-4">
                    <a href="/client/reviews" class="p-2 rounded-lg hover:bg-gray-100">
                        <span class="material-symbols-outlined">arrow_back</span>
                    </a>
                    <h2 class="text-2xl font-bold text-stone-900">Leave a Review</h2>
                </div>
                <div class="flex items-center gap-4">
                    @await Html.PartialAsync("_NotificationDropdown")
                    <div class="w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center">
                        <span class="material-symbols-outlined text-primary">person</span>
                    </div>
                </div>
            </header>

            <main class="flex-1 p-8 bg-background-light overflow-y-auto mt-16">
                <div class="max-w-3xl mx-auto">
                    <!-- Service Info Card -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 rounded-lg bg-primary/20 flex items-center justify-center">
                                <span class="material-symbols-outlined text-primary text-3xl">design_services</span>
                            </div>
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-gray-900">@Model.ServiceName</h3>
                                <p class="text-sm text-gray-500">Share your experience with this service</p>
                            </div>
                            <div class="text-right">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                    Completed
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Review Form -->
                    <form asp-action="CreateReview" method="post" class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                        @Html.AntiForgeryToken()
                        <input type="hidden" asp-for="BookingID" />
                        <input type="hidden" asp-for="ServiceName" />
                        <input type="hidden" asp-for="Rating" id="ratingInput" value="0" />

                        <!-- Rating Section -->
                        <div class="mb-8">
                            <label class="block text-lg font-bold text-gray-900 mb-4">
                                How would you rate this service? <span class="text-red-500">*</span>
                            </label>
                            <div class="flex items-center gap-6">
                                <div class="star-rating" id="starRating">
                                    <span class="material-symbols-outlined star" data-rating="1">star</span>
                                    <span class="material-symbols-outlined star" data-rating="2">star</span>
                                    <span class="material-symbols-outlined star" data-rating="3">star</span>
                                    <span class="material-symbols-outlined star" data-rating="4">star</span>
                                    <span class="material-symbols-outlined star" data-rating="5">star</span>
                                </div>
                                <span id="ratingText" class="text-lg font-medium text-gray-600">Select a rating</span>
                            </div>
                            <span asp-validation-for="Rating" class="text-red-500 text-sm mt-1 block"></span>
                        </div>

                        <!-- Comment Section -->
                        <div class="mb-6">
                            <label class="block text-lg font-bold text-gray-900 mb-3">
                                Share your experience <span class="text-red-500">*</span>
                            </label>
                            <p class="text-sm text-gray-500 mb-3">Tell others about your experience with this service. What did you like? What could be improved?</p>
                            <textarea asp-for="Comment"
                                      rows="6"
                                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary resize-none"
                                      placeholder="Write your review here... (minimum 10 characters)"
                                      required
                                      minlength="10"></textarea>
                            <div class="flex justify-between items-center mt-2">
                                <span asp-validation-for="Comment" class="text-red-500 text-sm"></span>
                                <span id="charCount" class="text-sm text-gray-500">0 characters</span>
                            </div>
                        </div>

                        <!-- Tips Section -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                            <div class="flex gap-3">
                                <span class="material-symbols-outlined text-primary flex-shrink-0">lightbulb</span>
                                <div>
                                    <h4 class="font-semibold text-gray-900 mb-2">Tips for writing a great review:</h4>
                                    <ul class="text-sm text-gray-600 space-y-1">
                                        <li>• Be specific about what you liked or didn't like</li>
                                        <li>• Mention the quality of service and professionalism</li>
                                        <li>• Share details that might help other clients</li>
                                        <li>• Be honest but constructive</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="flex gap-4 pt-4 border-t border-gray-200">
                            <a href="/client/reviews" class="flex-1 py-3 px-4 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 text-center font-semibold transition-colors">
                                Cancel
                            </a>
                            <button type="submit"
                                    id="submitBtn"
                                    class="flex-1 py-3 px-4 bg-primary text-white rounded-lg hover:bg-primary/90 text-center font-semibold transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"
                                    disabled>
                                <span class="flex items-center justify-center gap-2">
                                    <span class="material-symbols-outlined">send</span>
                                    Submit Review
                                </span>
                            </button>
                        </div>

                        <!-- Note -->
                        <p class="text-xs text-gray-500 text-center mt-4">
                            Your review will be visible to other users after admin approval
                        </p>
                    </form>

                    <!-- Review Guidelines -->
                    <div class="mt-6 bg-gray-50 rounded-lg p-4 border border-gray-200">
                        <h4 class="font-semibold text-gray-900 mb-2 flex items-center gap-2">
                            <span class="material-symbols-outlined text-gray-600">info</span>
                            Review Guidelines
                        </h4>
                        <p class="text-sm text-gray-600">
                            Please ensure your review is respectful and constructive. Reviews containing inappropriate language, personal attacks, or spam will not be approved. Your feedback helps improve our services and assists other clients in making informed decisions.
                        </p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://ajax.aspnetcdn.com/ajax/jquery.validate/1.19.3/jquery.validate.min.js"></script>
    <script src="https://ajax.aspnetcdn.com/ajax/jquery.validation.unobtrusive/3.2.12/jquery.validate.unobtrusive.min.js"></script>
    <script src="~/js/notifications.js"></script>
    <script>
        let selectedRating = 0;
        const stars = document.querySelectorAll('.star');
        const ratingInput = document.getElementById('ratingInput');
        const ratingText = document.getElementById('ratingText');
        const commentTextarea = document.querySelector('textarea[name="Comment"]');
        const charCount = document.getElementById('charCount');
        const submitBtn = document.getElementById('submitBtn');

        const ratingLabels = {
            1: 'Poor',
            2: 'Fair',
            3: 'Good',
            4: 'Very Good',
            5: 'Excellent'
        };

        // Star rating functionality
        stars.forEach(star => {
            star.addEventListener('click', function() {
                selectedRating = parseInt(this.dataset.rating);
                ratingInput.value = selectedRating;
                updateStars(selectedRating);
                updateRatingText(selectedRating);
                validateForm();
            });

            star.addEventListener('mouseenter', function() {
                const rating = parseInt(this.dataset.rating);
                updateStars(rating);
            });
        });

        document.getElementById('starRating').addEventListener('mouseleave', function() {
            updateStars(selectedRating);
        });

        function updateStars(rating) {
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        function updateRatingText(rating) {
            if (rating > 0) {
                ratingText.textContent = ratingLabels[rating];
                ratingText.classList.add('text-primary', 'font-bold');
            } else {
                ratingText.textContent = 'Select a rating';
                ratingText.classList.remove('text-primary', 'font-bold');
            }
        }

        // Character count
        commentTextarea.addEventListener('input', function() {
            const length = this.value.length;
            charCount.textContent = `${length} character${length !== 1 ? 's' : ''}`;
            validateForm();
        });

        // Form validation
        function validateForm() {
            const hasRating = selectedRating > 0;
            const hasComment = commentTextarea.value.trim().length >= 10;
            submitBtn.disabled = !(hasRating && hasComment);
        }

        // Form submission
        document.querySelector('form').addEventListener('submit', function(e) {
            if (selectedRating === 0) {
                e.preventDefault();
                alert('Please select a rating');
                return false;
            }

            if (commentTextarea.value.trim().length < 10) {
                e.preventDefault();
                alert('Please write at least 10 characters in your review');
                return false;
            }
        });

        // Initialize validation
        validateForm();
    </script>
</body>
</html>