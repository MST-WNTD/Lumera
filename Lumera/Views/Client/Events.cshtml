@model Lumera.Models.ClientEventsViewModel
@using Lumera.Services
@{
    ViewData["Title"] = "My Events - LUMERA";
    Layout = null;
    var currentFilter = ViewBag.CurrentFilter as string ?? "upcoming";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>@ViewData["Title"]</title>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&amp;display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#13a4ec",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101c22",
                    },
                    fontFamily: {
                        "display": ["Manrope"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
    </style>
</head>
<body class="font-display bg-background-light dark:bg-background-dark text-stone-800 dark:text-stone-200">
    <div class="flex h-screen overflow-hidden">
        <!-- Unified Sidebar -->
        <aside class="w-64 bg-white dark:bg-background-dark flex flex-col border-r border-stone-200 dark:border-stone-800 fixed left-0 top-0 h-screen z-30">
            <div class="p-6 flex items-center gap-3">
                <div class="bg-primary p-2 rounded-lg">
                    <span class="material-symbols-outlined text-white">event</span>
                </div>
                <h1 class="text-xl font-bold text-stone-900 dark:text-white">LUMERA</h1>
            </div>

            <!-- Client Info -->
            <div class="px-6 py-4 border-b border-stone-200 dark:border-stone-800">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center">
                        <span class="material-symbols-outlined text-primary">person</span>
                    </div>
                    <div>
                        <p class="font-semibold text-stone-900 dark:text-white">@(Model.Client.User?.FirstName ?? "User") @(Model.Client.User?.LastName ?? "")</p>
                        <p class="text-sm text-stone-500 dark:text-stone-400">Client</p>
                    </div>
                </div>
            </div>

            <nav class="flex-1 px-4 py-2">
                <a class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-primary/10 dark:hover:bg-primary/20 text-stone-600 dark:text-stone-300" href="/client/dashboard">
                    <span class="material-symbols-outlined">dashboard</span> Dashboard
                </a>
                <a class="flex items-center gap-3 px-4 py-2 rounded-lg bg-primary/10 dark:bg-primary/20 text-primary font-bold" href="/client/events">
                    <span class="material-symbols-outlined">event</span> My Events
                </a>
                <a class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-primary/10 dark:hover:bg-primary/20 text-stone-600 dark:text-stone-300" href="/client/browse">
                    <span class="material-symbols-outlined">search</span> Browse & Book
                </a>
                <a class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-primary/10 dark:hover:bg-primary/20 text-stone-600 dark:text-stone-300" href="/client/bookings">
                    <span class="material-symbols-outlined">book_online</span> Bookings & Services
                </a>
                <a class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-primary/10 dark:hover:bg-primary/20 text-stone-600 dark:text-stone-300" href="/client/messages">
                    <span class="material-symbols-outlined">mail</span> Messages
                    @if (Model.UnreadMessages > 0)
                    {
                        <span class="bg-red-500 text-white text-xs rounded-full px-2 py-1 ml-auto">@Model.UnreadMessages</span>
                    }
                </a>
                <a class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-primary/10 dark:hover:bg-primary/20 text-stone-600 dark:text-stone-300" href="/client/reviews">
                    <span class="material-symbols-outlined">reviews</span> My Reviews
                </a>
                <a class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-primary/10 dark:hover:bg-primary/20 text-stone-600 dark:text-stone-300" href="/client/profile">
                    <span class="material-symbols-outlined">settings</span> Profile Settings
                </a>
            </nav>

            <!-- Logout Option -->
            <div class="p-4 border-t border-stone-200 dark:border-stone-800 mt-auto">
                <a class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-primary/10 dark:hover:bg-primary/20 text-stone-600 dark:text-stone-300" href="/home/index">
                    <span class="material-symbols-outlined">logout</span> Logout
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col ml-64">
            <!-- Header -->
            <header class="flex h-16 items-center justify-between border-b border-stone-200 dark:border-stone-800 bg-white dark:bg-background-dark px-6 fixed top-0 right-0 left-64 z-20">
                <div class="flex items-center gap-4">
                    <h2 class="text-2xl font-bold text-stone-900 dark:text-white">My Events</h2>
                    <p class="text-stone-500 dark:text-stone-400">Manage your events and bookings</p>
                </div>
                <div class="flex items-center gap-4">

                    @await Html.PartialAsync("_NotificationDropdown")

                    <div class="w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center">
                        <span class="material-symbols-outlined text-primary">person</span>
                    </div>
                </div>
            </header>

            <!-- Main Content -->
            <main class="flex-1 p-8 bg-background-light dark:bg-background-dark overflow-y-auto mt-16">
                @if (TempData["SuccessMessage"] != null)
                {
                    <div id="successAlert" class="mb-6 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <span class="material-symbols-outlined text-green-600 dark:text-green-400">check_circle</span>
                            <p class="text-green-800 dark:text-green-200 font-medium">@TempData["SuccessMessage"]</p>
                        </div>
                        <button onclick="this.parentElement.remove()" class="text-green-600 dark:text-green-400 hover:text-green-800 dark:hover:text-green-200">
                            <span class="material-symbols-outlined">close</span>
                        </button>
                    </div>
                }

                <!-- Updated Tabs with Status Filter -->
                <div class="border-b border-gray-200 dark:border-gray-700/50 mb-6 flex justify-between items-center">
                    <nav aria-label="Tabs" class="flex -mb-px space-x-8">
                        <a href="/client/events?filter=all"
                           class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm @(currentFilter == "all" ? "text-primary border-primary" : "text-gray-500 dark:text-gray-400 border-transparent hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600")">
                            All (@(ViewBag.AllCount ?? 0))
                        </a>
                        <a href="/client/events?filter=pending"
                           class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm @(currentFilter == "pending" ? "text-primary border-primary" : "text-gray-500 dark:text-gray-400 border-transparent hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600")">
                            Pending (@(ViewBag.PendingCount ?? 0))
                        </a>
                        <a href="/client/events?filter=confirmed"
                           class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm @(currentFilter == "confirmed" ? "text-primary border-primary" : "text-gray-500 dark:text-gray-400 border-transparent hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600")">
                            Confirmed (@(ViewBag.ConfirmedCount ?? 0))
                        </a>
                        <a href="/client/events?filter=completed"
                           class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm @(currentFilter == "completed" ? "text-primary border-primary" : "text-gray-500 dark:text-gray-400 border-transparent hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600")">
                            Completed (@(ViewBag.CompletedCount ?? 0))
                        </a>
                        <a href="/client/events?filter=cancelled"
                           class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm @(currentFilter == "cancelled" ? "text-primary border-primary" : "text-gray-500 dark:text-gray-400 border-transparent hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600")">
                            Cancelled (@(ViewBag.CancelledCount ?? 0))
                        </a>
                    </nav>
                    <a asp-controller="Client" asp-action="CreateEvent" class="flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-white font-bold text-sm shadow-md hover:bg-opacity-90 transition-all flex-shrink-0 ml-4">
                        <span class="material-symbols-outlined">add</span><span>New Event</span>
                    </a>
                </div>

                    <!-- Table -->
                    <div class="bg-white dark:bg-background-dark rounded-lg shadow overflow-hidden">
                        @if (Model.Events.Any())
                        {
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-50 dark:bg-gray-800/20 text-sm text-gray-500 dark:text-gray-400 border-b border-gray-200 dark:border-gray-700">
                                        <tr>
                                            <th class="px-4 py-3 text-left font-medium">Event Name</th>
                                            <th class="px-4 py-3 text-center font-medium">Type</th>
                                            <th class="px-4 py-3 text-center font-medium">Date</th>
                                            <th class="px-4 py-3 text-center font-medium">Budget</th>
                                            <th class="px-4 py-3 text-center font-medium">Location</th>
                                            <th class="px-4 py-3 text-center font-medium">Status</th>
                                            <th class="px-4 py-3 text-center font-medium">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 dark:divide-gray-700/50">
                                        @foreach (var eventItem in Model.Events)
                                        {
                                            <tr class="text-sm hover:bg-gray-50 dark:hover:bg-stone-800/30 event-row">
                                                <td class="px-4 py-3 !text-left font-medium text-gray-900 dark:text-white event-name">
                                                    @eventItem.EventName
                                                </td>
                                                <td class="px-4 py-3 !text-center text-gray-600 dark:text-gray-300">
                                                    @eventItem.EventType
                                                </td>
                                                <td class="px-4 py-3 !text-center text-gray-600 dark:text-gray-300">
                                                    @eventItem.EventDate.ToString("MMM dd, yyyy")
                                                </td>
                                                <td class="px-4 py-3 !text-center font-semibold text-gray-900 dark:text-white">
                                                    @(eventItem.Budget.HasValue ? $"₱{eventItem.Budget.Value:N2}" : "-")
                                                </td>
                                                <td class="px-4 py-3 !text-center text-gray-600 dark:text-gray-300">
                                                    @(eventItem.Location ?? "-")
                                                </td>
                                            <td class="px-4 py-3 !text-center">
                                                @{
                                                    string statusLower = (eventItem.Status ?? "").ToLower();
                                                    var statusClass = statusLower switch
                                                    {
                                                        "confirmed" => "bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",
                                                        "pending" => "bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",
                                                        "planning" => "bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",
                                                        "draft" => "bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200",
                                                        "completed" => "bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",
                                                        "cancelled" => "bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",
                                                        _ => "bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"
                                                    };
                                                }
                                                <span class="inline-block px-3 py-1 text-xs font-medium rounded-full @statusClass">
                                                    @eventItem.Status
                                                </span>
                                            </td>
                                    <td class="px-4 py-3">
                                        <div class="flex items-center justify-center gap-2">
                                            @if (eventItem.Status != "Completed" && eventItem.Status != "Cancelled")
                                                    {
                                                        <a href="/Client/EditEvent/@eventItem.EventID" class="text-primary hover:underline font-medium">Edit</a>
                                                        <span class="text-gray-300 dark:text-gray-600">|</span>
                                                    }
                                                    <a href="/Client/EventDetails/@eventItem.EventID" class="text-primary hover:underline font-medium">View</a>
                                                </div>
                                            </td>
                                    </tr>
                                                                        }
                                    </tbody>
                                </table>
                            </div>
                        }
                        else
                        {
                            <div class="text-center py-12">
                                <span class="material-symbols-outlined text-gray-300 dark:text-gray-600 text-6xl mb-4">event</span>
                            @if (currentFilter == "all")
                            {
                                <p class="text-gray-500 dark:text-gray-400 mb-4">No events found</p>
                            }
                            else if (currentFilter == "pending")
                            {
                                <p class="text-gray-500 dark:text-gray-400 mb-4">No pending events</p>
                            }
                            else if (currentFilter == "confirmed")
                            {
                                <p class="text-gray-500 dark:text-gray-400 mb-4">No confirmed events</p>
                            }
                            else if (currentFilter == "completed")
                            {
                                <p class="text-gray-500 dark:text-gray-400 mb-4">No completed events</p>
                            }
                            else if (currentFilter == "cancelled")
                            {
                                <p class="text-gray-500 dark:text-gray-400 mb-4">No cancelled events</p>
                            }
                                <a href="/Client/CreateEvent" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 inline-flex items-center gap-2">
                                    <span class="material-symbols-outlined">add</span> Create Your First Event
                                </a>
                            </div>
                        }
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="~/js/notifications.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Search functionality
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.toLowerCase();
                    const eventRows = document.querySelectorAll('.event-row');

                    eventRows.forEach(row => {
                        const eventName = row.querySelector('.event-name').textContent.toLowerCase();
                        if (eventName.includes(searchTerm)) {
                            row.style.display = '';
                        } else {
                            row.style.display = 'none';
                        }
                    });
                });
            }

            // Auto-hide success message after 5 seconds
            const successAlert = document.getElementById('successAlert');
            if (successAlert) {
                setTimeout(() => {
                    successAlert.style.opacity = '0';
                    successAlert.style.transition = 'opacity 0.5s ease-out';
                    setTimeout(() => successAlert.remove(), 500);
                }, 5000);
            }
        });
    </script>
</body>
</html>