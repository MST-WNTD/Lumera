@model Lumera.Models.AdminViewModels.UserManagementViewModel
@{
    ViewData["Title"] = "User Management - LUMERA";
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>@ViewData["Title"]</title>
    <link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect" />
    <link as="style" href="https://fonts.googleapis.com/css2?display=swap&family=Manrope:wght@400;500;700;800&family=Noto+Sans:wght@400;500;700;900" onload="this.rel='stylesheet'" rel="stylesheet" />
    <link href="data:image/x-icon;base64," rel="icon" type="image/x-icon" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#13a4ec",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101c22",
                    },
                    fontFamily: {
                        "display": ["Manrope"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
    </style>
</head>
<body class="font-display bg-background-light dark:bg-background-dark text-stone-800 dark:text-stone-200">
    <div class="flex h-screen overflow-hidden">
        <!-- Unified Sidebar -->
        <aside class="w-64 bg-white dark:bg-background-dark flex flex-col border-r border-stone-200 dark:border-stone-800 fixed left-0 top-0 h-screen z-30">
            <div class="p-6 flex items-center gap-3">
                <div class="bg-primary p-2 rounded-lg">
                    <span class="material-symbols-outlined text-white">admin_panel_settings</span>
                </div>
                <h1 class="text-xl font-bold text-stone-900 dark:text-white">LUMERA</h1>
            </div>

            <!-- Admin Info -->
            <div class="px-6 py-4 border-b border-stone-200 dark:border-stone-800">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center">
                        <span class="material-symbols-outlined text-primary">admin_panel_settings</span>
                    </div>
                    <div>
                        <p class="font-semibold text-stone-900 dark:text-white">Administrator</p>
                        <p class="text-sm text-stone-500 dark:text-stone-400">Admin</p>
                    </div>
                </div>
            </div>

            <nav class="flex-1 px-4 py-2">
                <a class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-primary/10 dark:hover:bg-primary/20 text-stone-600 dark:text-stone-300"
                   href="@Url.Action("Index", "Admin")">
                    <span class="material-symbols-outlined">dashboard</span> Dashboard
                </a>
                <a class="flex items-center gap-3 px-4 py-2 rounded-lg bg-primary/10 dark:bg-primary/20 text-primary font-bold"
                   href="@Url.Action("UserManagement", "Admin")">
                    <span class="material-symbols-outlined">group</span> User Management
                </a>
                <a class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-primary/10 dark:hover:bg-primary/20 text-stone-600 dark:text-stone-300"
                   href="@Url.Action("ContentModeration", "Admin")">
                    <span class="material-symbols-outlined">content_paste</span> Content Moderation
                </a>
            </nav>

            <!-- Logout Option -->
            <div class="p-4 border-t border-stone-200 dark:border-stone-800 mt-auto">
                <form method="post" asp-controller="Account" asp-action="Logout" class="w-full">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-primary/10 dark:hover:bg-primary/20 text-stone-600 dark:text-stone-300 w-full text-left">
                        <span class="material-symbols-outlined">logout</span> Logout
                    </button>
                </form>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col ml-64">
            <!-- Header -->
            <header class="flex h-16 items-center justify-between border-b border-stone-200 dark:border-stone-800 bg-white dark:bg-background-dark px-6 fixed top-0 right-0 left-64 z-20">
                <div class="flex items-center gap-4">
                    <h2 class="text-2xl font-bold text-stone-900 dark:text-white">User Management</h2>
                    <p class="text-stone-500 dark:text-stone-400">Manage all user accounts and permissions</p>
                </div>
            </header>

            <!-- Main Content -->
            <main class="flex-1 p-8 bg-background-light dark:bg-background-dark overflow-y-auto mt-16">
                <!-- Page Title -->
                <div class="mb-8"></div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white dark:bg-stone-900 rounded-xl shadow-sm p-6">
                        <div class="flex items-center gap-4">
                            <div class="bg-blue-100 dark:bg-blue-900 p-3 rounded-lg">
                                <span class="material-symbols-outlined text-blue-600 dark:text-blue-400">group</span>
                            </div>
                            <div>
                                <p class="text-2xl font-bold text-stone-900 dark:text-white">@Model.PaginationInfo.TotalCount</p>
                                <p class="text-sm text-stone-500 dark:text-stone-400">Total Users</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-stone-900 rounded-xl shadow-sm p-6">
                        <div class="flex items-center gap-4">
                            <div class="bg-yellow-100 dark:bg-yellow-900 p-3 rounded-lg">
                                <span class="material-symbols-outlined text-yellow-600 dark:text-yellow-400">pending_actions</span>
                            </div>
                            <div>
                                <p class="text-2xl font-bold text-stone-900 dark:text-white">@Model.Users.Count(u => !u.IsApproved)</p>
                                <p class="text-sm text-stone-500 dark:text-stone-400">Pending Approval</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-stone-900 rounded-xl shadow-sm p-6">
                        <div class="flex items-center gap-4">
                            <div class="bg-green-100 dark:bg-green-900 p-3 rounded-lg">
                                <span class="material-symbols-outlined text-green-600 dark:text-green-400">check_circle</span>
                            </div>
                            <div>
                                <p class="text-2xl font-bold text-stone-900 dark:text-white">@Model.Users.Count(u => u.IsActive && u.IsApproved)</p>
                                <p class="text-sm text-stone-500 dark:text-stone-400">Active Users</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-stone-900 rounded-xl shadow-sm p-6">
                        <div class="flex items-center gap-4">
                            <div class="bg-red-100 dark:bg-red-900 p-3 rounded-lg">
                                <span class="material-symbols-outlined text-red-600 dark:text-red-400">block</span>
                            </div>
                            <div>
                                <p class="text-2xl font-bold text-stone-900 dark:text-white">@Model.Users.Count(u => !u.IsActive)</p>
                                <p class="text-sm text-stone-500 dark:text-stone-400">Suspended Users</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- User Management Section -->
                <div class="bg-white dark:bg-stone-900 rounded-xl shadow-sm p-6" id="user-management">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-stone-900 dark:text-white">All Users</h3>
                        <div class="flex items-center gap-4">
                            <div class="relative">
                                <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-stone-400">search</span>
                                <input class="pl-10 pr-4 py-2 border border-stone-300 dark:border-stone-700 rounded-lg bg-white dark:bg-stone-800 text-stone-900 dark:text-stone-200 focus:outline-none focus:ring-2 focus:ring-primary" placeholder="Search users..." type="text" id="userSearch" />
                            </div>
                            <div class="relative">
                                <select class="pl-4 pr-10 py-2 border border-stone-300 dark:border-stone-700 rounded-lg bg-white dark:bg-stone-800 text-stone-900 dark:text-stone-200 focus:outline-none focus:ring-2 focus:ring-primary appearance-none" id="roleFilter">
                                    <option value="">All Roles</option>
                                    <option value="Client">Client</option>
                                    <option value="Organizer">Organizer</option>
                                    <option value="Supplier">Supplier</option>
                                    <option value="Admin">Admin</option>
                                </select>
                                <span class="material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-stone-400">arrow_drop_down</span>
                            </div>
                            <div class="relative">
                                <select class="pl-4 pr-10 py-2 border border-stone-300 dark:border-stone-700 rounded-lg bg-white dark:bg-stone-800 text-stone-900 dark:text-stone-200 focus:outline-none focus:ring-2 focus:ring-primary appearance-none" id="statusFilter">
                                    <option value="">All Status</option>
                                    <option value="Active">Active</option>
                                    <option value="Pending">Pending Approval</option>
                                    <option value="Suspended">Suspended</option>
                                </select>
                                <span class="material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-stone-400">arrow_drop_down</span>
                            </div>
                        </div>
                    </div>

                    <!-- Tabs -->
                    <div class="border-b border-stone-200 dark:border-stone-700 mb-6">
                        <nav aria-label="Tabs" class="-mb-px flex space-x-8">
                            <a class="border-primary text-primary whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm status-tab" data-status="all" href="#">All Users</a>
                            <a class="border-transparent text-stone-500 dark:text-stone-400 hover:text-stone-700 dark:hover:text-stone-300 hover:border-stone-300 dark:hover:border-stone-600 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm status-tab" data-status="pending" href="#">Pending Approval</a>
                            <a class="border-transparent text-stone-500 dark:text-stone-400 hover:text-stone-700 dark:hover:text-stone-300 hover:border-stone-300 dark:hover:border-stone-600 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm status-tab" data-status="suspended" href="#">Suspended</a>
                        </nav>
                    </div>

                    <!-- Users Table -->
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="text-sm text-stone-500 dark:text-stone-400">
                                <tr>
                                    <th class="p-3 font-medium">User</th>
                                    <th class="p-3 font-medium">Email</th>
                                    <th class="p-3 font-medium">Role</th>
                                    <th class="p-3 font-medium">Status</th>
                                    <th class="p-3 font-medium">Created</th>
                                    <th class="p-3 font-medium">Last Login</th>
                                    <th class="p-3 font-medium">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body" class="divide-y divide-stone-200 dark:divide-stone-800">
                                @foreach (var user in Model.Users)
                                {
                                    <tr class="text-sm user-row hover:bg-stone-50 dark:hover:bg-stone-800/50"
                                        data-status="@(user.IsActive ? (user.IsApproved ? "active" : "pending") : "suspended")">
                                        <td class="p-3 font-medium text-stone-900 dark:text-white whitespace-nowrap">
                                            <div class="flex items-center gap-3">
                                                @if (!string.IsNullOrEmpty(user.AvatarURL))
                                                {
                                                    <img class="w-8 h-8 rounded-full" src="@user.AvatarURL" alt="@user.FirstName" />
                                                }
                                                else
                                                {
                                                    <div class="w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center text-primary font-bold text-sm">
                                                        @user.FirstName[0]@user.LastName[0]
                                                    </div>
                                                }
                                                <div>
                                                    <div class="font-medium">@user.FirstName @user.LastName</div>
                                                    <div class="text-xs text-stone-500">ID: @user.UserID</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="p-3">@user.Email</td>
                                        <td class="p-3">
                                            <span class="px-2 py-1 text-xs rounded-full bg-primary/10 text-primary dark:bg-primary/20">@user.Role</span>
                                        </td>
                                        <td class="p-3">
                                            @if (!user.IsActive)
                                            {
                                                <span class="px-2 py-1 text-xs rounded-full bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300">Suspended</span>
                                            }
                                            else if (!user.IsApproved)
                                            {
                                                <span class="px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300">Pending Approval</span>
                                            }
                                            else
                                            {
                                                <span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300">Active</span>
                                            }
                                        </td>
                                        <td class="p-3">@user.CreatedAt.ToString("MMM dd, yyyy")</td>
                                        <td class="p-3">
                                            @if (user.LastLogin.HasValue)
                                            {
                                                @user.LastLogin.Value.ToString("MMM dd, yyyy")
                                            }
                                            else
                                            {
                                                <span class="text-stone-400">Never</span>
                                            }
                                        </td>
                                        <div id="userModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                                            <div class="bg-white dark:bg-stone-900 rounded-xl shadow-xl max-w-3xl w-full p-8">
                                                <!-- Header -->
                                                <div class="flex justify-between items-start mb-6">
                                                    <h3 class="text-2xl font-bold text-stone-900 dark:text-white">User Profile</h3>
                                                    <button onclick="closeUserModal()" class="text-stone-400 hover:text-stone-600 dark:hover:text-stone-300">
                                                        <span class="material-symbols-outlined">close</span>
                                                    </button>
                                                </div>

                                                <!-- Profile -->
                                                <div class="flex items-center gap-6 mb-8">
                                                    <div class="w-20 h-20 rounded-full bg-primary/20 flex items-center justify-center text-primary font-bold text-2xl">
                                                        <span class="material-symbols-outlined">person</span>
                                                    </div>
                                                    <div>
                                                        <p id="modal-user-name" class="text-xl font-semibold text-stone-900 dark:text-white"></p>
                                                        <p id="modal-user-email" class="text-sm text-stone-500 dark:text-stone-400"></p>
                                                    </div>
                                                </div>

                                                <!-- Details Grid -->
                                                <div class="grid grid-cols-2 gap-6 text-sm">
                                                    <div>
                                                        <label class="flex items-center gap-1 font-medium text-stone-500 dark:text-stone-400">
                                                            <span class="material-symbols-outlined text-sm">badge</span> Role
                                                        </label>
                                                        <p id="modal-user-role" class="mt-1 px-2 py-1 inline-block rounded-full bg-primary/10 text-primary dark:bg-primary/20"></p>
                                                    </div>
                                                    <div>
                                                        <label class="flex items-center gap-1 font-medium text-stone-500 dark:text-stone-400">
                                                            <span class="material-symbols-outlined text-sm">verified_user</span> Status
                                                        </label>
                                                        <p id="modal-user-status" class="mt-1 px-2 py-1 inline-block rounded-full"></p>
                                                    </div>
                                                    <div>
                                                        <label class="flex items-center gap-1 font-medium text-stone-500 dark:text-stone-400">
                                                            <span class="material-symbols-outlined text-sm">event</span> Created
                                                        </label>
                                                        <p id="modal-user-created" class="mt-1"></p>
                                                    </div>
                                                    <div>
                                                        <label class="flex items-center gap-1 font-medium text-stone-500 dark:text-stone-400">
                                                            <span class="material-symbols-outlined text-sm">schedule</span> Last Login
                                                        </label>
                                                        <p id="modal-user-lastlogin" class="mt-1"></p>
                                                    </div>
                                                    <div class="col-span-2">
                                                        <label class="flex items-center gap-1 font-medium text-stone-500 dark:text-stone-400">
                                                            <span class="material-symbols-outlined text-sm">fingerprint</span> User ID
                                                        </label>
                                                        <p id="modal-user-id" class="mt-1 text-xs text-stone-500 dark:text-stone-400"></p>
                                                    </div>
                                                </div>

                                                <!-- Actions -->
                                                <div class="flex justify-end gap-3 mt-8">
                                                    <button onclick="closeUserModal()" class="px-4 py-2 rounded-lg bg-stone-100 text-stone-700 dark:bg-stone-700 dark:text-white hover:bg-stone-200 dark:hover:bg-stone-600">
                                                        Close
                                                    </button>
                                                </div>
                                            </div>
                                        </div>

                                        <td class="p-3">
                                            <div class="flex items-center gap-2">
                                                <button class="text-primary hover:text-primary/80 hover:underline flex items-center gap-1 text-xs view-user"
                                                        data-name="@user.FirstName @user.LastName"
                                                        data-email="@user.Email"
                                                        data-role="@user.Role"
                                                        data-status="@(user.IsActive ? (user.IsApproved ? "Active" : "Pending Approval") : "Suspended")"
                                                        data-created="@user.CreatedAt.ToString("MMM dd, yyyy")"
                                                        data-lastlogin="@(user.LastLogin.HasValue? user.LastLogin.Value.ToString("MMM dd, yyyy") : "Never")"
                                                        data-id="@user.UserID">
                                                    <span class="material-symbols-outlined text-sm">visibility</span> View
                                                </button>

                                                <span class="text-stone-300 dark:text-stone-600">|</span>
                                                @if (user.IsActive && user.IsApproved)
                                                {
                                                    <button class="text-yellow-600 hover:text-yellow-700 hover:underline flex items-center gap-1 text-xs suspend-user" data-userid="@user.UserID">
                                                        <span class="material-symbols-outlined text-sm">pause</span> Suspend
                                                    </button>
                                                }
                                                else if (user.IsActive && !user.IsApproved)
                                                {
                                                    <button class="text-green-600 hover:text-green-700 hover:underline flex items-center gap-1 text-xs approve-user" data-userid="@user.UserID">
                                                        <span class="material-symbols-outlined text-sm">check</span> Approve
                                                    </button>
                                                }
                                                else if (!user.IsActive)
                                                {
                                                    <button class="text-green-600 hover:text-green-700 hover:underline flex items-center gap-1 text-xs activate-user" data-userid="@user.UserID">
                                                        <span class="material-symbols-outlined text-sm">play_arrow</span> Activate
                                                    </button>
                                                }
                                                <span class="text-stone-300 dark:text-stone-600">|</span>
                                                <button class="text-red-600 hover:text-red-700 hover:underline flex items-center gap-1 text-xs delete-user" data-userid="@user.UserID">
                                                    <span class="material-symbols-outlined text-sm">delete</span> Delete
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <div class="flex items-center justify-between mt-6">
                        <div class="text-sm text-stone-700 dark:text-stone-400">
                            Showing <span class="font-medium">@Model.PaginationInfo.StartIndex</span> to <span class="font-medium">@Model.PaginationInfo.EndIndex</span> of <span class="font-medium">@Model.PaginationInfo.TotalCount</span> results
                        </div>
                        <div class="flex space-x-2">
                            @if (Model.PaginationInfo.HasPreviousPage)
                            {
                                <a href="@Url.Action("UserManagement", "Admin", new { page = Model.PaginationInfo.CurrentPage - 1 })" class="px-3 py-1 rounded-lg border border-stone-300 dark:border-stone-700 bg-white dark:bg-stone-800 text-stone-700 dark:text-stone-300 hover:bg-stone-50 dark:hover:bg-stone-700 text-sm">Previous</a>
                            }
                            @for (int i = 1; i <= Model.PaginationInfo.TotalPages; i++)
                            {
                                <a href="@Url.Action("UserManagement", "Admin", new { page = i })" class="px-3 py-1 rounded-lg border @(i == Model.PaginationInfo.CurrentPage ? "border-primary bg-primary text-white" : "border-stone-300 dark:border-stone-700 bg-white dark:bg-stone-800 text-stone-700 dark:text-stone-300 hover:bg-stone-50 dark:hover:bg-stone-700") text-sm">@i</a>
                            }
                            @if (Model.PaginationInfo.HasNextPage)
                            {
                                <a href="@Url.Action("UserManagement", "Admin", new { page = Model.PaginationInfo.CurrentPage + 1 })" class="px-3 py-1 rounded-lg border border-stone-300 dark:border-stone-700 bg-white dark:bg-stone-800 text-stone-700 dark:text-stone-300 hover:bg-stone-50 dark:hover:bg-stone-700 text-sm">Next</a>
                            }
                        </div>
                    </div>
                    <div id="userModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                        <div class="bg-white dark:bg-stone-900 rounded-xl shadow-xl max-w-2xl w-full p-6">
                            <div class="flex justify-between items-start mb-4">
                                <h3 class="text-xl font-bold text-stone-900 dark:text-white">User Details</h3>
                                <button onclick="closeUserModal()" class="text-stone-400 hover:text-stone-600 dark:hover:text-stone-300">
                                    <span class="material-symbols-outlined">close</span>
                                </button>
                            </div>

                            <div class="space-y-4">
                                <div>
                                    <label class="text-sm font-medium text-stone-500 dark:text-stone-400">Name</label>
                                    <p id="modal-user-name" class="text-stone-900 dark:text-white font-medium"></p>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-stone-500 dark:text-stone-400">Email</label>
                                    <p id="modal-user-email" class="text-stone-900 dark:text-white"></p>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-stone-500 dark:text-stone-400">Role</label>
                                    <p id="modal-user-role" class="text-stone-900 dark:text-white"></p>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-stone-500 dark:text-stone-400">Status</label>
                                    <p id="modal-user-status" class="text-stone-900 dark:text-white"></p>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-stone-500 dark:text-stone-400">Created</label>
                                    <p id="modal-user-created" class="text-stone-900 dark:text-white"></p>
                                </div>
                            </div>

                            <div class="flex justify-end gap-3 mt-6">
                                <button onclick="closeUserModal()" class="px-4 py-2 rounded-lg bg-stone-100 text-stone-700 dark:bg-stone-700 dark:text-white hover:bg-stone-200 dark:hover:bg-stone-600">
                                    Close
                                </button>
                            </div>
                        </div>
                    </div>

                </div>
            </main>
        </div>
    </div>

    @Html.AntiForgeryToken()

    <script>
        // View Modal
        document.addEventListener('DOMContentLoaded', function() {
          document.querySelectorAll('.view-user').forEach(button => {
            button.addEventListener('click', function(e) {
              e.preventDefault();

              document.getElementById('modal-user-name').textContent = this.dataset.name;
              document.getElementById('modal-user-email').textContent = this.dataset.email;
              document.getElementById('modal-user-role').textContent = this.dataset.role;
              document.getElementById('modal-user-status').textContent = this.dataset.status;
              document.getElementById('modal-user-created').textContent = this.dataset.created;
              document.getElementById('modal-user-lastlogin').textContent = this.dataset.lastlogin;
              document.getElementById('modal-user-id').textContent = this.dataset.id;

              document.getElementById('userModal').classList.remove('hidden');
            });
          });
        });

        function closeUserModal() {
          document.getElementById('userModal').classList.add('hidden');
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Status tab functionality
            document.querySelectorAll('.status-tab').forEach(tab => {
                tab.addEventListener('click', function(e) {
                    e.preventDefault();

                    // Update active tab styling
                    document.querySelectorAll('.status-tab').forEach(t => {
                        t.classList.remove('border-primary', 'text-primary');
                        t.classList.add('border-transparent', 'text-stone-500', 'dark:text-stone-400');
                    });

                    this.classList.remove('border-transparent', 'text-stone-500', 'dark:text-stone-400');
                    this.classList.add('border-primary', 'text-primary');

                    // Filter users by status
                    const status = this.getAttribute('data-status');
                    filterUsersByStatus(status);
                });
            });

            // User management actions
            document.querySelectorAll('.approve-user').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    const userId = this.getAttribute('data-userid');
                    updateUserStatus(userId, 'approve');
                });
            });

            document.querySelectorAll('.suspend-user').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    const userId = this.getAttribute('data-userid');
                    updateUserStatus(userId, 'suspend');
                });
            });

            document.querySelectorAll('.activate-user').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    const userId = this.getAttribute('data-userid');
                    updateUserStatus(userId, 'activate');
                });
            });

            document.querySelectorAll('.delete-user').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    const userId = this.getAttribute('data-userid');
                    if (confirm('Are you sure you want to delete this user? This action cannot be undone.')) {
                        updateUserStatus(userId, 'delete');
                    }
                });
            });

            // Search and filter functionality
            document.getElementById('userSearch').addEventListener('input', debounce(filterUsers, 300));
            document.getElementById('roleFilter').addEventListener('change', filterUsers);
            document.getElementById('statusFilter').addEventListener('change', filterUsers);
        });

        function filterUsersByStatus(status) {
            const rows = document.querySelectorAll('#users-table-body .user-row');

            rows.forEach(row => {
                const rowStatus = row.getAttribute('data-status');

                if (status === 'all' || rowStatus === status) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        async function updateUserStatus(userId, action) {
            try {
                const response = await fetch('@Url.Action("UpdateUserStatus", "Admin")', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                    },
                    body: JSON.stringify({ userId: userId, action: action })
                });

                if (response.ok) {
                    location.reload();
                } else {
                    const error = await response.text();
                    alert('Error updating user status: ' + error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error updating user status');
            }
        }

        function filterUsers() {
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            const roleFilter = document.getElementById('roleFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const activeTab = document.querySelector('.status-tab.border-primary');
            const activeStatus = activeTab ? activeTab.getAttribute('data-status') : 'all';

            const rows = document.querySelectorAll('#users-table-body .user-row');

            rows.forEach(row => {
                const name = row.cells[0].textContent.toLowerCase();
                const email = row.cells[1].textContent.toLowerCase();
                const role = row.cells[2].textContent.toLowerCase();
                const status = row.cells[3].textContent.toLowerCase();
                const rowStatus = row.getAttribute('data-status');

                const matchesSearch = name.includes(searchTerm) || email.includes(searchTerm);
                const matchesRole = !roleFilter || role.includes(roleFilter.toLowerCase());
                const matchesStatusFilter = !statusFilter || status.includes(statusFilter.toLowerCase());
                const matchesTabStatus = activeStatus === 'all' || rowStatus === activeStatus;

                row.style.display = (matchesSearch && matchesRole && matchesStatusFilter && matchesTabStatus) ? '' : 'none';
            });
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    </script>
</body>
</html>